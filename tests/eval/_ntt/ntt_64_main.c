// requires VLEN >= 512

#include <stdio.h>
#include <assert.h>
// #define DEBUG

void ntt(const int *array, int l, const int *twiddle, int p, int *dst);

void test() {
  const int l = 6;
  const int n = 64;
  static const int arr[64] = {
      9997,  6362,  7134,  11711, 5849,  9491,  5972,  4164,  5894,  11069,
      7697,  8319,  2077,  12086, 10239, 5394,  4898,  1370,  1205,  2997,
      5274,  4625,  11983, 1789,  3645,  7666,  12128, 10883, 7376,  8883,
      2321,  1889,  2026,  8059,  2741,  865,   1785,  9955,  2395,  9330,
      11465, 7383,  9649,  11285, 3647,  578,   1158,  9936,  12019, 11114,
      7894,  4832,  10148, 10363, 11388, 9122,  10758, 2642,  4171,  10586,
      1194,  5280,  3055,  9220};
  // const int twiddle[6] = {7311, 5860, 4134, 8246, 1479, 12288};
  static const int twiddle[] = {
    // layer #0
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 

    // layer #1
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1479, 1479, 1479, 1479, 1479, 1479, 1479, 1479, 1479, 1479, 1479, 1479, 1479, 1479, 1479, 1479, 

    // layer #2
    1, 1, 1, 1, 1, 1, 1, 1, 8246, 8246, 8246, 8246, 8246, 8246, 8246, 8246, 1479, 1479, 1479, 1479, 1479, 1479, 1479, 1479, 5146, 5146, 5146, 5146, 5146, 5146, 5146, 5146, 

    // layer #3
    1, 1, 1, 1, 4134, 4134, 4134, 4134, 8246, 8246, 8246, 8246, 11567, 11567, 11567, 11567, 1479, 1479, 1479, 1479, 6553, 6553, 6553, 6553, 5146, 5146, 5146, 5146, 1305, 1305, 1305, 1305, 

    // layer #4
    1, 1, 5860, 5860, 4134, 4134, 3621, 3621, 8246, 8246, 1212, 1212, 11567, 11567, 8785, 8785, 1479, 1479, 3195, 3195, 6553, 6553, 9744, 9744, 5146, 5146, 10643, 10643, 1305, 1305, 3542, 3542, 

    // layer #5
    1, 7311, 5860, 3006, 4134, 5023, 3621, 2625, 8246, 8961, 1212, 563, 11567, 5728, 8785, 4821, 1479, 10938, 3195, 9545, 6553, 6461, 9744, 11340, 5146, 5777, 10643, 9314, 1305, 4591, 3542, 2639, 
    
  };
  const int p = 12289;
  int dst[64];
  ntt(arr, l, twiddle, p, dst);

#ifdef DEBUG
  const int gold[64] = {
    10604, 5675, 6810, 7140, 1904, 9720, 6400, 10542, 3966, 4691, 10317, 3405, 8021, 4907, 2423, 4615, 10421, 312, 11656, 1583, 2465, 10550, 1846, 10270, 8157, 9464, 9661, 11992, 11334, 10446, 11934, 10487, 6801, 8418, 6663, 6332, 10968, 1319, 9237, 6893, 3514, 8723, 3764, 6500, 1933, 2383, 5885, 2866, 8001, 8606, 2074, 5181, 11232, 6811, 4379, 8587, 4037, 4716, 9113, 2527, 3301, 1641, 3869, 8614
  };
  for (int i = 0; i < n; i++) {
    // dst[i] = dst[i] % p;
    if(dst[i] < 0) dst[i] += p;
    if(dst[i] != gold[i]) {
      printf("(%d %d, i)", dst[i], gold[i], i);
      if ((i + 1) % 8 == 0) {
        printf("\n");
      } else {
        printf(" ");
      }
    }
  }
#endif
}

#ifdef DEBUG
int main(void) {
  test();
}
#endif
