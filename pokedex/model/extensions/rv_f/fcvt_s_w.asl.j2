{%- macro fp_from_int_body(name, op) %}
  if !isEnabled_FS() then
    return IllegalInstruction();
  end

  let fd: FRegIdx = UInt(GetRD(instruction));
  let rs1: XRegIdx = UInt(GetRS1(instruction));

  let (rm: RM, valid: boolean) = resolveFrmDynamic(GetRM(instruction));
  if !valid then
    return IllegalInstruction();
  end

  let src1: bits(32) = X[rs1];

  let res: F32_Flags = {{ op }}(rm, src1);

  F[fd] = res.value;
  accureFFlags(res.fflags);  

  makeDirty_FS();
  PC = PC + 4;
  return Retired();
{% endmacro -%}

func Execute_FCVT_S_W(instruction: bits(32)) => Result
begin
{{- fp_from_int_body("fcvt_s_w", "riscv_f32_fromSInt32") -}}
end

func Execute_FCVT_S_WU(instruction: bits(32)) => Result
begin
{{- fp_from_int_body("fcvt_s_wu", "riscv_f32_fromUInt32") -}}
end
